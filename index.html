<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piedra, Papel, Tijeras</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            overflow: hidden;
        }

        #gameControls {
            margin: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }

        #gameArea {
            position: relative;
            width: 80%;
            height: 70%;
            border: 2px solid #ffffff;
            overflow: hidden;
        }

        .element {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            user-select: none;
        }

        .stone {
            background-color: #8b8b8b;
        }

        .paper {
            background-color: #4caf50;
        }

        .scissors {
            background-color: #ff5722;
        }

        #winner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            display: none;
        }

        #winner img {
            width: 100px;
            height: 100px;
        }

        #restart {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #4caf50;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }

        #restart:hover {
            background-color: #45a049;
        }

        #toolbar {
            margin-top: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 80%;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 10px;
        }

        .tool {
            cursor: pointer;
            font-size: 24px;
            padding: 10px;
            border-radius: 50%;
        }

        .tool.active {
            background-color: #4caf50;
        }
    </style>
</head>
<body>
    <div id="gameControls">
        <label for="stones">Piedras:</label>
        <input type="number" id="stones" min="0" max="20" value="5">
        <label for="papers">Papel:</label>
        <input type="number" id="papers" min="0" max="20" value="5">
        <label for="scissors">Tijeras:</label>
        <input type="number" id="scissors" min="0" max="20" value="5">
        <label for="speed">Velocidad:</label>
        <input type="range" id="speed" min="1" max="10" value="5">
        <button onclick="startGame()">Iniciar Juego</button>
    </div>
    <div id="gameArea"></div>
    <div id="winner">
        <img id="winnerImage" src="" alt="Winner">
        <h1>Winner!</h1>
        <button id="restart" onclick="restartGame()">Reiniciar</button>
    </div>
    <div id="toolbar">
        <div class="tool active" id="selectStone" data-type="stone">ü™®</div>
        <div class="tool" id="selectPaper" data-type="paper">üìÑ</div>
        <div class="tool" id="selectScissors" data-type="scissors">‚úÇÔ∏è</div>
    </div>

    <script>
        const gameArea = document.getElementById('gameArea');
        const winnerScreen = document.getElementById('winner');
        const winnerImage = document.getElementById('winnerImage');
        const speedControl = document.getElementById('speed');
        const tools = document.querySelectorAll('.tool');
        let selectedType = 'stone';
        let elements = [];
        let interval;
        let speed = 5;
        let mouseDown = false;
        const activeCollisions = new Set();

        function startGame() {
            clearInterval(interval);
            gameArea.innerHTML = '';
            elements = [];
            winnerScreen.style.display = 'none';

            const stoneCount = parseInt(document.getElementById('stones').value);
            const paperCount = parseInt(document.getElementById('papers').value);
            const scissorsCount = parseInt(document.getElementById('scissors').value);

            createElements('stone', stoneCount);
            createElements('paper', paperCount);
            createElements('scissors', scissorsCount);

            interval = setInterval(updatePositions, 50);
        }

        function createElements(type, count) {
            for (let i = 0; i < count; i++) {
                createElement(type, Math.random() * (gameArea.offsetWidth - 40), Math.random() * (gameArea.offsetHeight - 40));
            }
        }

        speedControl.addEventListener('input', () => {
            speed = parseInt(speedControl.value);
        });

        tools.forEach(tool => {
            tool.addEventListener('click', () => {
                tools.forEach(t => t.classList.remove('active'));
                tool.classList.add('active');
                selectedType = tool.dataset.type;
            });
        });

        gameArea.addEventListener('mousedown', () => (mouseDown = true));
        gameArea.addEventListener('mouseup', () => (mouseDown = false));
        gameArea.addEventListener('mousemove', (event) => {
            if (mouseDown) {
                const rect = gameArea.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                createElement(selectedType, x, y);
            }
        });

        function createElement(type, x, y) {
            const element = document.createElement('div');
            element.classList.add('element', type);
            element.dataset.type = type;
            element.dataset.id = `${type}-${Math.random().toString(36).substring(7)}`;
            element.style.left = `${x - 20}px`;
            element.style.top = `${y - 20}px`;
            element.dataset.dx = (Math.random() < 0.5 ? -1 : 1) * speed;
            element.dataset.dy = (Math.random() < 0.5 ? -1 : 1) * speed;
            element.innerText = type === 'stone' ? 'ü™®' : type === 'paper' ? 'üìÑ' : '‚úÇÔ∏è';
            gameArea.appendChild(element);
            elements.push(element);
        }

        function updatePositions() {
            elements.forEach(el => {
                let x = parseFloat(el.style.left);
                let y = parseFloat(el.style.top);
                let dx = parseFloat(el.dataset.dx);
                let dy = parseFloat(el.dataset.dy);

                x += dx;
                y += dy;

                if (x <= 0 || x >= gameArea.offsetWidth - 40) dx *= -1;
                if (y <= 0 || y >= gameArea.offsetHeight - 40) dy *= -1;

                el.style.left = `${x}px`;
                el.style.top = `${y}px`;
                el.dataset.dx = dx;
                el.dataset.dy = dy;

                elements.forEach(other => {
                    if (el !== other && el.dataset.type !== other.dataset.type) {
                        const collisionId = `${el.dataset.id}-${other.dataset.id}`;
                        const reverseCollisionId = `${other.dataset.id}-${el.dataset.id}`;

                        if (
                            checkCollision(el, other) &&
                            !activeCollisions.has(collisionId) &&
                            !activeCollisions.has(reverseCollisionId)
                        ) {
                            handleCollision(el, other);
                            activeCollisions.add(collisionId);
                        }
                    }
                });
            });

            activeCollisions.clear();

            const types = new Set(elements.map(el => el.dataset.type));
            if (types.size === 1 && elements.length > 0) {
                clearInterval(interval);
                showWinner([...types][0]);
            }
        }

        function checkCollision(el1, el2) {
            const x1 = parseFloat(el1.style.left) + 20;
            const y1 = parseFloat(el1.style.top) + 20;
            const x2 = parseFloat(el2.style.left) + 20;
            const y2 = parseFloat(el2.style.top) + 20;

            const distance = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            return distance < 40;
        }

        function handleCollision(el1, el2) {
            const rules = {
                stone: 'scissors',
                paper: 'stone',
                scissors: 'paper',
            };

            if (rules[el1.dataset.type] === el2.dataset.type) {
                el2.classList.remove(el2.dataset.type);
                el2.dataset.type = el1.dataset.type;
                el2.classList.add(el1.dataset.type);
                el2.innerText = el1.dataset.type === 'stone' ? 'ü™®' : el1.dataset.type === 'paper' ? 'üìÑ' : '‚úÇÔ∏è';
            } else if (rules[el2.dataset.type] === el1.dataset.type) {
                el1.classList.remove(el1.dataset.type);
                el1.dataset.type = el2.dataset.type;
                el1.classList.add(el2.dataset.type);
                el1.innerText = el2.dataset.type === 'stone' ? 'ü™®' : el2.dataset.type === 'paper' ? 'üìÑ' : '‚úÇÔ∏è';
            }

            const tempDx = el1.dataset.dx;
            const tempDy = el1.dataset.dy;

            el1.dataset.dx = el2.dataset.dx;
            el1.dataset.dy = el2.dataset.dy;
            el2.dataset.dx = tempDx;
            el2.dataset.dy = tempDy;
        }

        function showWinner(winnerType) {
            winnerScreen.style.display = 'block';
            winnerImage.src =
                winnerType === 'stone'
                    ? 'https://img.icons8.com/emoji/96/rock.png'
                    : winnerType === 'paper'
                    ? 'https://img.icons8.com/emoji/96/page-facing-up.png'
                    : 'https://img.icons8.com/emoji/96/scissors.png';
        }

        function restartGame() {
            startGame();
        }
    </script>
</body>
</html>
